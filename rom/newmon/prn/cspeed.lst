		; Command module for CPU Speed Control
		
			maclib	core
**** core.lib ****
**** cspeed.asm ****
			maclib	ram
**** ram.lib ****
**** cspeed.asm ****
			maclib	z80
**** z80.lib ****
**** cspeed.asm ****
		
000D          	CR	equ	13
000A          	LF	equ	10
0008          	BS	equ	8
0003          	CTLC	equ	3
0007          	BEL	equ	7
001B          	ESC	equ	27
		
0014          	spbits	equ	00010100b
0014          	mhz10	equ	00010100b
0004          	mhz8	equ	00000100b
0010          	mhz4	equ	00010000b
0000          	mhz2	equ	00000000b
		
1000          		org	1000h
1000  01      	first:	db	HIGH (last-first)	; +0: num pages
1001  10      		db	HIGH first		; +1: ORG page
1002  FF00    		db	255,0	; +2,+3: phy drv base, num
		
1004  C31610  		jmp	init	; +4: init entry
1007  C31810  		jmp	exec	; +7: action entry
		
100A  5A      		db	'Z'	; +10: Command letter
100B  FF      		db	-1	; +11: front panel key
100C  00      		db	0	; +12: port, 0 if variable
100D  FFFFFF  		db	11111111b,11111111b,11111111b	; +13: FP display
1010  53706565		db	'Speed',0	; +16: mnemonic string
      6400
		
1016          	init:
1016  AF      		xra	a	; NC
1017  C9      		ret
		
1018          	exec:
1018  21A410  		lxi	h,signon
101B  CD4400  		call	msgout
101E  21AF10  		lxi	h,mis
1021  CD4A00  	spd0:	call	conin
1024  FE0D    		cpi	CR
1026  283E    		jrz	show
1028  FE32    		cpi	'2'
102A  0E00    		mvi	c,mhz2
102C  281B    		jrz	ok
102E  FE34    		cpi	'4'
1030  0E10    		mvi	c,mhz4
1032  2815    		jrz	ok
1034  FE38    		cpi	'8'
1036  0E04    		mvi	c,mhz8
1038  280F    		jrz	ok
103A  E65F    		ani	01011111b
103C  FE4D    		cpi	'M'
103E  0E14    		mvi	c,mhz10
1040  2807    		jrz	ok
1042  3E07    		mvi	a,BEL
1044  CDA010  		call	chrout
1047  18D8    		jr	spd0
1049  CDA010  	ok:	call	chrout
104C  CD4A00  		call	conin
104F  FE0D    		cpi	CR
1051  2804    		jrz	ok1
1053  3E07    		mvi	a,BEL
1055  18F2    		jr	ok
1057  213620  	ok1:	lxi	h,ctl$F2
105A  F3      		di
105B  7E      		mov	a,m
105C  E6EB    		ani	NOT spbits
105E  B1      		ora	c
105F  77      		mov	m,a
1060  D3F2    		out	0f2h
1062  FB      		ei
1063  21B310  		lxi	h,mset
1066  E5      	show:	push	h
1067  CD1B00  		call	crlf
106A  21A410  		lxi	h,signon
106D  CD4400  		call	msgout
1070  E1      		pop	h
1071  CD4400  		call	msgout
1074  3A3620  		lda	ctl$F2
1077  E614    		ani	spbits
1079  FE00    		cpi	mhz2
107B  0E32    		mvi	c,'2'
107D  2814    		jrz	got
107F  FE10    		cpi	mhz4
1081  0E34    		mvi	c,'4'
1083  280E    		jrz	got
1085  FE04    		cpi	mhz8
1087  0E38    		mvi	c,'8'
1089  2808    		jrz	got
			; must be MAX
108B  21BB10  		lxi	h,mmax
108E  CD4400  		call	msgout
1091  180A    		jr	fin
1093  79      	got:	mov	a,c
1094  CDA010  		call	chrout
1097  21BF10  		lxi	h,mmhz
109A  CD4400  		call	msgout
109D  C31B00  	fin:	jmp	crlf
		
10A0  2A2600  	chrout:	lhld	conout
10A3  E9      		pchl
		
10A4  43505520	signon:	db	'CPU speed ',0
      73706565
      642000
		
10AF  69732000	mis:	db	'is ',0
10B3  73657420	mset:	db	'set to ',0
      746F2000
10BB  4D617800	mmax:	db	'Max',0
10BF  4D487A00	mmhz:	db	'MHz',0
		
10C3  FFFFFFFF		rept	(($+0ffh) and 0ff00h)-$
      FFFFFFFF
      FFFFFFFF
      FFFFFFFF
      FFFFFFFF
      FFFFFFFF
      FFFFFFFF
      FFFFFFFF
      FFFFFFFF
      FFFFFFFF
      FFFFFFFF
      FFFFFFFF
      FFFFFFFF
      FFFFFFFF
      FFFFFFFF
      FF
		
1100          	last:	end



Statistics:

     4	passes
     0	jr promotions
    97	symbols
   256	bytes

    97	macro calls
  3759	macro bytes
     0	invented symbols
